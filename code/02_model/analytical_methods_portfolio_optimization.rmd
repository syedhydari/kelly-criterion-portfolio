---
title: "Analytical Derivation of Portfolio Optimization Methods"
subtitle: "Reproduction of Analytical Methodsfrom Carta & Conversano (2020)"
author: "Syed Bashir Hydari"
format: 
  pdf:
    toc: true
    number-sections: true
---

# Introduction

This document reproduces the analytical (mathematical) derivation of the tangent portfolio optimization under the Kelly Criterion as presented in Carta and Conversano (2020), Section 2.2.2-2.2.3.

# Starting Point: Continuous Probability Distribution

## Objective Function (Equation 3)

For a financial asset with continuous probability distribution, the goal is to maximize:

$$g(f) = E[\log(1 + fx)] = \int \log(1 + fx) dP(x)$$

where:
- $f$ = fraction of invested capital
- $x$ = outcome (return) of the investment
- $P(x)$ = probability measure for the outcome
- Constraint: $1 + fx > 0$ to avoid undefined logarithms

## Assumptions

Assume outcomes $x$ are distributed as a symmetric random variable around $E(x) = \mu$ with $Var(x) = \sigma^2$:

$$\Pr(x = \mu + \sigma) = \Pr(x = \mu - \sigma) = 0.5$$

# Single Asset Derivation

## Wealth Dynamics

The wealth after investing fraction $f$ is:

$$W(f) = W_0[1 + (1-f)r + fx] = W_0[1 + r + f(x - r)]$$

where $r$ is the risk-free rate. 

## Expected Growth Rate

$$g(f) = E[G(f)] = E\left[\log\frac{W(f)}{W_0}\right] = E\{\log[1 + r + f(x-r)]\}$$

Expanding:
$$= 0.5\log[1 + r + f(\mu + \sigma - r)] + 0.5\log[1 + r + f(\mu - \sigma - r)]$$

## Taylor Approximation (Equation 5)

Dividing time into $n$ sub-intervals, the growth rate becomes:

$$g_n(f) = nE\left[\log\left(1 + \frac{r}{n} + f\left(\frac{\mu}{n} + \frac{U\sigma}{\sqrt{n}} - \frac{r}{n}\right)\right)\right]$$

where $U = \pm 1$ is a symmetric Bernoulli random variable.

Using the expansion $\log(1 + u) = u - \frac{u^2}{2} + O(u^3)$ when $u \to 0$:

$$\frac{g_n(f)}{n} = \frac{r}{n} + f\left(\frac{\mu}{n} + E(U)\frac{\sigma}{\sqrt{n}} - \frac{r}{n}\right) - \frac{f^2\sigma^2 E(U^2)}{2n} + O\left(n^{-\frac{3}{2}}\right)$$

## Continuous Time Limit (Equation 7)

Since $E(U) = 0$ and $E(U^2) = 1$:

$$\frac{g_n(f)}{n} = \frac{r}{n} + f\left(\frac{\mu}{n} - \frac{r}{n}\right) - \frac{f^2\sigma^2}{2n} + O\left(n^{-\frac{3}{2}}\right)$$

Simplifying:
$$= r + f(\mu - r) - \frac{f^2\sigma^2}{2} + O\left(n^{-\frac{1}{2}}\right)$$

As $n \to \infty$, $O(n^{-\frac{1}{2}}) \to 0$, giving **Equation (8)**:

$$\boxed{g_{\infty}(f) = r + f(\mu - r) - \frac{f^2\sigma^2}{2}}$$

## Optimal Kelly Fraction (Equation 9)

To maximize $g_{\infty}(f)$, take the first derivative:

$$\frac{dg_{\infty}}{df} = (\mu - r) - f\sigma^2 = 0$$

Solving for $f$:

$$\boxed{f^* = \frac{\mu - r}{\sigma^2}}$$

This is the **optimal Kelly fraction for a single asset**.

# Multi-Asset Portfolio Extension

## Problem Setup

Consider:
- $n$ risky assets with expected returns $M = (\mu_1, \ldots, \mu_n)^T$
- Variance-covariance matrix $\Sigma$ with elements $\Sigma_{ij} = E[(r_i - \mu_i)(r_j - \mu_j)]$
- Portfolio weights $F = (f_1, \ldots, f_n)^T$
- Risk-free rate $r$, with vector $R = (r, \ldots, r)^T$

## Portfolio Return and Variance

Portfolio expected return:
$$\mu_p = f_0 r + \sum_{i=1}^{n} f_i \mu_i = r + F^T(M - R)$$

where $f_0 = 1 - \sum_{i=1}^{n} f_i$ is the fraction in the risk-free asset.

Portfolio variance:
$$\sigma_p^2 = F^T \Sigma F$$

## Multi-Asset Growth Rate (Equation 11)

Following Thorp [8], as cited in the paper, the single-asset growth rate formula extends to the multi-asset case.   The paper states (without derivation) that for a portfolio of securities with continuous probability distributions:

$$g_{\infty}(f_1, \ldots, f_n) = r + F^T(M - R) - \frac{F^T \Sigma F}{2}$$

This is **Equation (11)** in the paper.  Note that this is a **stated result** from Thorp's work, not derived by Carta & Conversano. 

# Tangent Portfolio Optimization

## Objective

Maximize the expected growth rate:

$$\max_F \left[r + F^T(M - R) - \frac{F^T \Sigma F}{2}\right]$$

## First-Order Condition

Take the gradient with respect to $F$:

$$\nabla_F g_{\infty}(F) = \frac{\partial}{\partial F}\left[r + F^T(M - R) - \frac{1}{2}F^T \Sigma F\right]$$

Using matrix calculus:
- $\frac{\partial}{\partial F}(F^T(M-R)) = M - R$
- $\frac{\partial}{\partial F}\left(\frac{1}{2}F^T \Sigma F\right) = \Sigma F$ (since $\Sigma$ is symmetric)

Setting the gradient to zero:
$$(M - R) - \Sigma F = 0$$

## Analytical Solution (Equation 12)

Rearranging:
$$\Sigma F^* = M - R$$

Multiplying both sides by $\Sigma^{-1}$:

$$\boxed{F^* = \Sigma^{-1}[M - R]}$$

This is **Equation (12)** - the **analytical solution for the tangent portfolio**.

## Second-Order Condition

The Hessian matrix is:
$$H = \nabla^2_F g_{\infty}(F) = -\Sigma$$

Since $\Sigma$ is positive definite (by definition of a covariance matrix), $-\Sigma$ is negative definite.  This confirms that $F^*$ is a **maximum**. 

# Special Case: Uncorrelated Assets

When assets are uncorrelated, $\Sigma$ is diagonal:

$$\Sigma = \begin{pmatrix}
\sigma_1^2 & 0 & \cdots & 0 \\
0 & \sigma_2^2 & \cdots & 0 \\
\vdots & \vdots & \ddots & \vdots \\
0 & 0 & \cdots & \sigma_n^2
\end{pmatrix}$$

Then:
$$\Sigma^{-1} = \begin{pmatrix}
1/\sigma_1^2 & 0 & \cdots & 0 \\
0 & 1/\sigma_2^2 & \cdots & 0 \\
\vdots & \vdots & \ddots & \vdots \\
0 & 0 & \cdots & 1/\sigma_n^2
\end{pmatrix}$$

The optimal weight for each asset is:

$$\boxed{f_i^* = \frac{\mu_i - r}{\sigma_i^2}}$$

This reduces to the single-asset case for each independent asset.

# Reference Optimization (Equation 13)

The paper also considers the **constrained optimization** with bounds:

$$g^* = \arg\max_F \left[r + F^T(M - R) - \frac{F^T \Sigma F}{2}\right]$$

subject to:
$$\sum_{i=1}^n f_i \leq 1; \quad 0 \leq f_i \leq 1$$

This is the **tangent portfolio** with portfolio constraints (no short selling, fully invested condition).

The unconstrained solution $F^* = \Sigma^{-1}[M - R]$ may violate these constraints, requiring numerical optimization (as discussed in Section 2.2.3 of the paper).

# Summary

## Key Analytical Results

1. **Single Asset**: $f^* = \frac{\mu - r}{\sigma^2}$ (Equation 9)

2. **Multiple Assets (Unconstrained)**: $F^* = \Sigma^{-1}[M - R]$ (Equation 12)

3. **Uncorrelated Assets**: $f_i^* = \frac{\mu_i - r}{\sigma_i^2}$

4. **Growth Rate at Optimum**: 
   $$g_{\infty}(F^*) = r + \frac{1}{2}(M-R)^T\Sigma^{-1}(M-R)$$

## Interpretation

The tangent portfolio $F^*$ represents:
- The portfolio that maximizes long-term logarithmic growth (Kelly Criterion)
- The portfolio with maximum Sharpe ratio
- The point of tangency between the Capital Market Line and the efficient frontier

# References

Carta, A., & Conversano, C. (2020).  Practical Implementation of the Kelly Criterion: Risk Management, Simulations and Portfolios. *Frontiers in Applied Mathematics and Statistics*, 6, Article 577050. 